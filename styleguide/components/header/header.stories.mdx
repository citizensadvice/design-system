import { Meta, Story, Canvas } from '@storybook/addon-docs/blocks';

import initHeader from '../../../src/js/header';
import templateDefault from './../../examples/header/full_example.html';

<Meta
  title="Components/Header"
  decorators={[
    (Story) => {
      setTimeout(() => initHeader());
      return Story();
    },
  ]}
/>

# Header

<Canvas>
  <Story
    name="Default"
    parameters={{ docs: { source: { code: templateDefault } } }}
  >
    {() => templateDefault}
  </Story>
</Canvas>

## Using with Rails

If you are using the `citizens_advice_components` gem, you can call the component from within a template using:

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.logo(title: "Citizens Advice homepage", url: "/")
  c.skip_links(skip_links)
  c.header_links(header_links)
  c.search_form(search_action_url: "/search")
  c.account_link(title: "Sign in", url: "/sign-in")
end
```

### Slots API

The header component makes heavy use of [view component slots](https://viewcomponent.org/guide/slots.html). This allows each piece of the header to be configure each part of the header with a method.

Slots that have plural names like `skip_links` and `header_links` can be configured in flexible ways. Either by passing an array to the plural version of the method:

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.header_links([{ title: "Example link", url: "/some-url" }])
end
```

Or by calling the singular method name multiple times:

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.header_link(title: "Example link 1", url: "/some-url")
  c.header_link(title: "Example link 2", url: "/another-url")
end
```

### Logo slot

This is the only slot required by default. The slot takes a `title` and optional `url` (defaults to `/`).

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.logo(title: "Citizens Advice homepage")
end
```

### Skip links

Skip links are optional. We provide a default set for you but you can provide your own.

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.skip_links([
    { title: "Skip to content", url: "#content" },
    { title: "Skip to footer", url: "#footer" }
  ])
end
```

If you use the defaults you'll need to be using the `Navigation` and `Footer` components and add a `#cads-main-content` ID to your main content area.

### Header links

Header links can be configured either by passing a list of hashes to `header_links` or by calling `header_links` multiple times with a `title` and `url`. Header links also accept an optional `current_site` flag.

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.header_links([
    { title: "Public site", url: "/", current_site: true },
    { title: "AdviserNet", url: "/advisernet" },
    { title: "Cymraeg", url: "?lang=cy" }
  ])
end
```

### Search form slot

The search form is optional. In order to configure it you need to provide a `search_action_url` and optionally a `search_param` name (defaults to `:q`).

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.search_form(search_action_url: "/search", search_param: :search)
end
```

### Account link slot

The account link slot can be configured in two different ways. Either as a plain link accepting a `title` and `url`:

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.account_link(title: "Sign in", url: "/sign-in")
end
```

Or by passing a custom block to render your own HTML:

```rb
render CitizensAdviceComponents::Header.new do |c|
  c.account_link do
    form_tag("/sign-out") do
      button_tag("Sign out")
    end
  end
end
```

**Note:** If you use the custom block format you control the HTML rendered so you'll also need to handle styling yourself.

## Customising the logo

You can customise the logo by overriding the `.cads-logo` class within your own stylesheet.

The logo provided with this design system covers large and small responsive styles plus print versions. Be sure to cover all of these cases, or override them if not needed.

See `@citizensadvice/design-system/scss/6-components/_logo.scss` for the specific implementation.

## JavaScript behaviour

If you plan to use this component you will need to initialise the following JavaScript:

```js
import initHeader from '@citizensadvice/design-system/lib/header';
initHeader();
```

## Haml template options

The Haml partial supports the following locals:

| Property                   | Description                                             |
| -------------------------- | ------------------------------------------------------- |
| `root_path`                | Required, root path for the logo home link              |
| `links`                    | Optional, an array made up of links (see example below) |
| `sign_in_out`              | Optional, a hash with the following:                    |
| `sign_in_out[url]`         | &rarr; Required, url for the sign in link               |
| `sign_in_out[title] `      | &rarr; Required, title for the sign in link             |
| `sign_in_out[form] `       | &rarr; Optional, display the link in a form             |
| `search_action_url`        | Required, URL for the search form                       |
| `main_content_anchor_link` | Optional, defaults to `#cads-main-content`              |
| `homepage_url`             | Optional, defaults to `/`                               |

### `links` template option

The links variable allows you to insert links to the left of the `sign_in_out` link. Each link object has the following properties:

| Property       | Description                                                                      |
| -------------- | -------------------------------------------------------------------------------- |
| `title`        | Required, the text to display                                                    |
| `url`          | Required, the url of the link                                                    |
| `current_site` | Optional, a boolean used to render a span for the current site instead of a link |

### Skip links

The header contains three skip links that become visible when they receive focus. There are three links that link to the navigation, main content and footer.

You can override the default anchor link for linking to the main page content by passing in the `main_content_anchor_link` property above. Don't forget to add the id to the main content of your pages!
